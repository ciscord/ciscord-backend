# Migration `20200326225115-init1`

This migration has been generated by Denis at 3/26/2020, 10:51:15 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "dummy"."User" (
    "bio" text   ,
    "currentChannel" text   ,
    "email" text   ,
    "fullname" text  NOT NULL DEFAULT '',
    "id" text  NOT NULL ,
    "image" text   ,
    "isOnline" boolean  NOT NULL DEFAULT true,
    "owner" text   ,
    "password" text   ,
    "social" text   ,
    "username" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."Community" (
    "author" text   ,
    "description" text   ,
    "id" text  NOT NULL ,
    "image" text   ,
    "isPrivate" boolean  NOT NULL DEFAULT false,
    "name" text  NOT NULL DEFAULT '',
    "url" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."Channel" (
    "author" text   ,
    "community" text  NOT NULL ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "description" text   ,
    "id" text  NOT NULL ,
    "isPrivate" boolean  NOT NULL DEFAULT false,
    "name" text  NOT NULL DEFAULT '',
    "url" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."Message" (
    "author" text  NOT NULL ,
    "body" text   ,
    "channel" text   ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."ReplyMessage" (
    "author" text  NOT NULL ,
    "body" text  NOT NULL DEFAULT '',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "parent" text  NOT NULL ,
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."Reaction" (
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "message" text  NOT NULL ,
    "name" text  NOT NULL DEFAULT '',
    "updatedAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."Notification" (
    "action" text   ,
    "body" text   ,
    "channel" text   ,
    "community" text   ,
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "isRead" boolean  NOT NULL DEFAULT false,
    "message" text   ,
    "receiver" text  NOT NULL ,
    "sender" text  NOT NULL ,
    "type" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."File" (
    "Key" text  NOT NULL DEFAULT '',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "encoding" text  NOT NULL DEFAULT '',
    "filename" text  NOT NULL DEFAULT '',
    "filesize" text   ,
    "id" text  NOT NULL ,
    "message" text   ,
    "mimetype" text  NOT NULL DEFAULT '',
    "replyMessage" text   ,
    "uploader" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."Role" (
    "color" text  NOT NULL DEFAULT '',
    "createdAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "id" text  NOT NULL ,
    "roleSettings" text  NOT NULL DEFAULT '',
    "title" text  NOT NULL DEFAULT '',
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."ChannelInfo" (
    "channel" text  NOT NULL ,
    "id" text  NOT NULL ,
    "lastUpdateAt" timestamp(3)  NOT NULL DEFAULT '1970-01-01 00:00:00',
    "uniqueUserChannelPair" text  NOT NULL DEFAULT '',
    "user" text  NOT NULL ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."RemoteAttachment" (
    "description" text   ,
    "id" text  NOT NULL ,
    "parentMessage" text   ,
    "parentReplyMessage" text   ,
    "preview" text   ,
    "siteName" text   ,
    "title" text  NOT NULL DEFAULT '',
    "url" text  NOT NULL DEFAULT '',
    "videoLink" text   ,
    PRIMARY KEY ("id")
) 

CREATE TABLE "dummy"."_UserCommunityMember" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "dummy"."_ReactionToUser" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE TABLE "dummy"."_UserRoles" (
    "A" text  NOT NULL ,
    "B" text  NOT NULL 
) 

CREATE UNIQUE INDEX "User.username" ON "dummy"."User"("username")

CREATE UNIQUE INDEX "User.email" ON "dummy"."User"("email")

CREATE UNIQUE INDEX "Community.name" ON "dummy"."Community"("name")

CREATE UNIQUE INDEX "Community.url" ON "dummy"."Community"("url")

CREATE UNIQUE INDEX "Channel.url" ON "dummy"."Channel"("url")

CREATE UNIQUE INDEX "File.Key" ON "dummy"."File"("Key")

CREATE UNIQUE INDEX "Role.title" ON "dummy"."Role"("title")

CREATE UNIQUE INDEX "ChannelInfo.uniqueUserChannelPair" ON "dummy"."ChannelInfo"("uniqueUserChannelPair")

CREATE UNIQUE INDEX "_UserCommunityMember_AB_unique" ON "dummy"."_UserCommunityMember"("A","B")

CREATE  INDEX "_UserCommunityMember_B_index" ON "dummy"."_UserCommunityMember"("B")

CREATE UNIQUE INDEX "_ReactionToUser_AB_unique" ON "dummy"."_ReactionToUser"("A","B")

CREATE  INDEX "_ReactionToUser_B_index" ON "dummy"."_ReactionToUser"("B")

CREATE UNIQUE INDEX "_UserRoles_AB_unique" ON "dummy"."_UserRoles"("A","B")

CREATE  INDEX "_UserRoles_B_index" ON "dummy"."_UserRoles"("B")

ALTER TABLE "dummy"."User" ADD FOREIGN KEY ("currentChannel")REFERENCES "dummy"."Channel"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."Community" ADD FOREIGN KEY ("author")REFERENCES "dummy"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."Channel" ADD FOREIGN KEY ("author")REFERENCES "dummy"."User"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."Channel" ADD FOREIGN KEY ("community")REFERENCES "dummy"."Community"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."Message" ADD FOREIGN KEY ("author")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."Message" ADD FOREIGN KEY ("channel")REFERENCES "dummy"."Channel"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."ReplyMessage" ADD FOREIGN KEY ("author")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."ReplyMessage" ADD FOREIGN KEY ("parent")REFERENCES "dummy"."Message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."Reaction" ADD FOREIGN KEY ("message")REFERENCES "dummy"."Message"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."Notification" ADD FOREIGN KEY ("sender")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."Notification" ADD FOREIGN KEY ("receiver")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."Notification" ADD FOREIGN KEY ("community")REFERENCES "dummy"."Community"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."Notification" ADD FOREIGN KEY ("channel")REFERENCES "dummy"."Channel"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."Notification" ADD FOREIGN KEY ("message")REFERENCES "dummy"."Message"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."File" ADD FOREIGN KEY ("uploader")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."File" ADD FOREIGN KEY ("message")REFERENCES "dummy"."Message"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."File" ADD FOREIGN KEY ("replyMessage")REFERENCES "dummy"."ReplyMessage"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."ChannelInfo" ADD FOREIGN KEY ("user")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."ChannelInfo" ADD FOREIGN KEY ("channel")REFERENCES "dummy"."Channel"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."RemoteAttachment" ADD FOREIGN KEY ("parentMessage")REFERENCES "dummy"."Message"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."RemoteAttachment" ADD FOREIGN KEY ("parentReplyMessage")REFERENCES "dummy"."ReplyMessage"("id") ON DELETE SET NULL  ON UPDATE CASCADE

ALTER TABLE "dummy"."_UserCommunityMember" ADD FOREIGN KEY ("A")REFERENCES "dummy"."Community"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."_UserCommunityMember" ADD FOREIGN KEY ("B")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."_ReactionToUser" ADD FOREIGN KEY ("A")REFERENCES "dummy"."Reaction"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."_ReactionToUser" ADD FOREIGN KEY ("B")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."_UserRoles" ADD FOREIGN KEY ("A")REFERENCES "dummy"."Role"("id") ON DELETE CASCADE  ON UPDATE CASCADE

ALTER TABLE "dummy"."_UserRoles" ADD FOREIGN KEY ("B")REFERENCES "dummy"."User"("id") ON DELETE CASCADE  ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20200326225115-init1
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,151 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url      = env("DATABASE_URL")
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id                      String          @default(cuid()) @id
+  fullname                String
+  username                String          @unique
+  bio                     String?
+  email                   String?         @unique
+  password                String?
+  social                  String?
+  image                   String?
+  isOnline                Boolean         @default(true)
+  communitiesOwned        Community[]     @relation(name: "UserCommunityAuthor")
+  communitiesFollowed     Community[]     @relation(name: "UserCommunityMember")
+  currentChannel          Channel?
+  channelsInfo            ChannelInfo[]
+  messages                Message[]
+  files                   File[]
+  replyMessages           ReplyMessage[]
+  notificationsSend       Notification[]  @relation(name: "UserNotificationSender")
+  notificationsReceived   Notification[]  @relation(name: "UserNotificationReceiver")
+  reactions               Reaction[]
+  role                    Role[]          @relation(name: "UserRoles")
+  owner                   String?
+}
+
+model Community {
+  id                      String                    @default(cuid()) @id
+  name                    String                    @unique
+  url                     String                    @unique
+  image                   String?
+  description             String?
+  isPrivate               Boolean                   @default(false)
+  author                  User?                     @relation(name: "UserCommunityAuthor")
+  members                 User[]                    @relation(name: "UserCommunityMember")
+  channels                Channel[]
+  notifications           Notification[]
+}
+
+model Channel {
+  id                      String          @default(cuid()) @id
+  createdAt               DateTime        @default(now())
+  name                    String
+  url                     String          @unique
+  description             String?
+  isPrivate               Boolean         @default(false)
+  community               Community
+  author                  User?           @relation(name: "UserChannelAuthor")
+  messages                Message[]
+  typingUsers             User[]
+  notifications           Notification[]
+  userData                ChannelInfo[]
+}
+
+model Message {
+  id                      String             @default(cuid()) @id
+  createdAt               DateTime           @default(now())
+  updatedAt               DateTime            @updatedAt
+  body                    String?
+  channel                 Channel?
+  author                  User
+  attachments             File[]
+  remoteAttachments       RemoteAttachment[]
+  children                ReplyMessage[]
+  reactions               Reaction[]
+}
+
+model ReplyMessage {
+  id                      String              @default(cuid()) @id
+  createdAt               DateTime            @default(now())
+  updatedAt               DateTime            @updatedAt
+  body                    String
+  author                  User
+  attachments             File[]
+  remoteAttachments       RemoteAttachment[]
+  parent                  Message
+}
+
+model Reaction {
+  id                      String          @default(cuid()) @id
+  name                    String
+  createdAt               DateTime        @default(now())
+  updatedAt               DateTime        @updatedAt
+  users                   User[]
+  message                 Message
+}
+
+model Notification {
+  id                      String          @default(cuid()) @id
+  createdAt               DateTime        @default(now())
+  body                    String?
+  type                    String?
+  action                  String?
+  message                 Message?
+  channel                 Channel?
+  community               Community?
+  sender                  User            @relation(name: "UserNotificationSender")
+  receiver                User            @relation(name: "UserNotificationReceiver")
+  isRead                  Boolean         @default(false)
+}
+
+model File {
+  id                      String          @default(cuid()) @id
+  createdAt               DateTime        @default(now())
+  filename                String
+  mimetype                String
+  filesize                String?
+  message                 Message?
+  encoding                String
+  Key                     String          @unique
+  uploader                User
+}
+
+model Role {
+  id                      String          @default(cuid()) @id
+  createdAt               DateTime        @default(now())
+  title                   String          @unique
+  roleSettings            String
+  color                   String
+  users                   User[]          @relation(name: "UserRoles")
+}
+
+model ChannelInfo {
+  id                      String          @default(cuid()) @id
+  channel                 Channel
+  user                    User
+  lastUpdateAt            DateTime        @default(now())
+  uniqueUserChannelPair   String          @unique
+}
+
+model RemoteAttachment {
+  id                      String          @default(cuid()) @id
+  title                   String
+  description             String?
+  siteName                String?
+  url                     String
+  preview                 String?
+  videoLink               String?
+  parentMessage           Message?
+  parentReplyMessage      ReplyMessage?
+}
```


